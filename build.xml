<project name="Unitex-Java" default="dist" basedir=".">

	<description>Unitex.jar build file</description>

	<!-- set global properties for this build -->

	<property name="src-dir" location="src" />
	<property name="build-dir" location="build" />
	<property name="classes-dir" location="classes" />
	<property name="dist-dir" location="dist" />
	<property name="lib-dir" location="lib" />
	<property name="resources-dir" location="resources" />
	<property environment="env" />

	<!-- targets -->
	
	<target name="install-init">
		<input message="Please enter Unitex Home (default is env var UNITEX_HOME):" 
			addproperty="unitexHome" defaultvalue="${env.UNITEX_HOME}" />
		<property name="app-dir" location="${unitexHome}/App" />
	</target>

	<target name="init">
		<!-- Create the time stamp -->
		<tstamp />
		<!-- Create the build directory structure used by compile -->
		<mkdir dir="${build-dir}" />
		<mkdir dir="${classes-dir}" />
		<mkdir dir="${dist-dir}" />
	</target>

	<target name="clean" depends="init" description="clean up">
		<echo message="Deleting files in ${build-dir}" level="info" />
		<delete includeemptydirs="true">
			<fileset dir="${build-dir}" includes="**/*" />
		</delete>
		<echo message="Deleting files in ${classes-dir}" level="info" />
		<delete includeemptydirs="true">
			<fileset dir="${classes-dir}" includes="**/*" />
		</delete>
		<echo message="Deleting files in ${dist-dir}" level="info" />
		<delete includeemptydirs="true">
			<fileset dir="${dist-dir}" includes="**/*" />
		</delete>
	</target>

	<target name="compile" depends="init" description="compile the source">
		<!-- Compile the java source code -->
		<javac srcdir="${src-dir}" destdir="${build-dir}" includeAntRuntime="false">
			<classpath>
				<fileset dir="${lib-dir}">
					<include name="*.jar" />
				</fileset>
			</classpath>
		</javac>
		<!-- "Compile" (indeed just copy) resources -->
		<copy todir="${classes-dir}">
			<fileset dir="${resources-dir}" />
		</copy>
		<!-- Move compiled code to ${classes-dir} -->
		<move todir="${classes-dir}">
			<fileset dir="${build-dir}" />
		</move>
	</target>

	<target name="dist" depends="clean,compile" description="generate the distribution">
		<copy todir="${dist-dir}">
			<fileset dir="${lib-dir}">
				<include name="*.jar" />
			</fileset>
		</copy>
		<!-- create Unitex.jar -->
		<jar jarfile="${dist-dir}/Unitex.jar" manifest="classes/fr/umlv/unitex/Manifest.mf" basedir="classes" excludes="classes/fr/loria/**" />
		<!-- create XAlign.jar -->
		<jar jarfile="${dist-dir}/XAlign.jar" manifest="classes/fr/loria/Manifest.mf" basedir="classes" excludes="classes/fr/umlv/**" />

	</target>

	<target name="install" depends="install-init,dist">
		<copy todir="${app-dir}">
			<fileset dir="${dist-dir}" />
		</copy>
	</target>
</project>

